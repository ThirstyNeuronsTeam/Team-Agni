<html>
  <head>
    <link rel="stylesheet" href="styles.css">
    <script src="./components/Transaction.js"></script>
    <script>
      const transactions = [];

      let balanceTot = 0;

      let incomeTot = 0;
      let expenseTot = 0;

      let reason = "";
      let amount = 0;

      const callWhenDeleteButtonClicked = (targetId) => {
        console.log("able to get click from child")
    
          let targetIndex=-1
          for (let tranIndex=0;tranIndex<transactions.length;tranIndex++){
            if(transactions[tranIndex].id===targetId){
              targetIndex = tranIndex;
            }
          }
          transactions.splice(targetIndex,1);

          const transactionsDiv = document.getElementById("transactionsDiv");

          transactionsDiv.removeChild(document.getElementById(targetId))

          console.log(transactions)
      }


      const renderTransaction = (newTransaction) => {

        //console.log(newTransaction);

        const transactionsDiv = document.getElementById("transactionsDiv");

        
        Transaction(newTransaction,transactionsDiv,callWhenDeleteButtonClicked)

        /*const reasonDiv = document.createElement("span");
        reasonDiv.textContent = newTransaction.reason;

        const amountDiv = document.createElement("span");
        amountDiv.textContent = newTransaction.amount;

        const indicator = document.createElement("div");
        indicator.style = newTransaction.amount<0 ? "width:10px;height:10px;background-color:red":"width:10px;height:10px;background-color:green"


        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        singleTransactionWrapperDiv.append(deleteButton);
        singleTransactionWrapperDiv.append(reasonDiv);
        singleTransactionWrapperDiv.append(amountDiv);
        singleTransactionWrapperDiv.append(indicator);*/

        

      };
      const calcBalance = () => {
        incomeTot=0;
        expenseTot=0;
        for (let tranIndex=0;tranIndex<transactions.length;tranIndex=tranIndex+1){
          //console.log(transactions[tranIndex]);
          if (transactions[tranIndex].amount >0){
             incomeTot = incomeTot+transactions[tranIndex].amount;
            }
            if (transactions[tranIndex].amount <0){
             expenseTot = expenseTot+transactions[tranIndex].amount;
            }

        }
        const incomeElement = document.getElementById("income");
        incomeElement.textContent = incomeTot;
        
        const expenseElement = document.getElementById("expense");
        expenseElement.textContent = Math.abs(expenseTot);

        const balanceElement = document.getElementById("balance");
        balanceElement.textContent = incomeTot+expenseTot;
      }
      const addTransaction = (reason, amount) => {
        const newTransaction = {
          id: Math.random(),
          reason: reason,
          amount: amount,
        };
        transactions.push(newTransaction);
        
        calcBalance();

        renderTransaction(newTransaction);
      };

      const submitTransaction = (event) => {
        event.preventDefault();
        const formElement = event.target;
        const reason = formElement[0].value;
        const amount = Number(formElement[1].value);

        addTransaction(reason,amount);
      };

      const onReasonChange = (event) => {
        /*const value = event.target.value
        console.log(value)
        if(!!value && value.length>=5){
          event.target.value = value.substring(0,5) //0,1,2,3,4
        }*/
      };

      const onAmountChange = (event) => {
        //console.log(event.target.value);
      };
    </script>
  </head>
  <body style="width: 100vw;height:100vh; display:flex; justify-content:center;align-items:center;">
   
    <div class="Application">
      <div class="Title" id="title">Expense Tracker</div>
      <div class="Information"  id="information">
        <div class="Balance">Your Balance<span id="balance"></span></div>
        <div class="Income">Income<span id="income"></span></div>
        <div class="Expense">Expense<span id="expense"></span></div>
      </div>

      <div class="Transactions" id="transactionsDiv">

      </div>

      <form
        id="transactionForm"
        onsubmit="submitTransaction(event); return false;"
      >
        <div>
          <label for="reason">Reason</label>
          <input
            placeholder="Enter Reason"
            id="reason"
            oninput="onReasonChange(event)"
          />
        </div>
        <div>
          <label for="amount">Amount</label>
          <input
            placeholder="Enter Amount"
            id="amount"
            type="number"
            oninput="onAmountChange(event)"
          />
        </div>
        <button type="submit">Add Transaction</button>
        </form>
    </div>
  </body>
</html>
